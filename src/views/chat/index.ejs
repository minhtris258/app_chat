<%
// Trang chat khรดng cแบงn navbar -> cรณ thแป tแบฏt nแบฟu muแปn
// locals.showNavbar = false;
%>

<!-- ==== PHแบฆN CHAT โ chแป markup nแปi dung, dแป style ==== -->
<div class="shell">
  <aside class="sidebar">
    <div class="sidebar-top">
      <div class="brand">Talky</div>
      <div class="search"><input id="searchInput" placeholder="Tรฌm kiแบฟm" /></div>
    </div>

    <div class="me-card" id="meCard">
      <div class="avatar" id="meAvatar">๐</div>
      <div class="me-info">
        <div class="me-name" id="meName">Bแบกn</div>
        <div class="me-status online">Online</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="all">Tแบฅt cแบฃ</button>
      <button class="tab" data-tab="groups">Nhรณm</button>
      <button class="tab" data-tab="pinned">Ghim</button>
      <button class="tab" data-tab="archived">Lฦฐu trแปฏ</button>
    </div>

    <ul class="conv-list" id="convList"></ul>

<div class="sidebar-footer">
      <button id="requestsBtn" class="btn outline small">๐ Yรชu cแบงu KB (<span id="requestCount">0</span>)</button>
      <button id="searchFriendBtn" class="btn outline small">๐ Tรฌm bแบกn</button>
      <button id="newGroupBtn" class="btn outline small">+ Tแบกo nhรณm</button>
      <button id="logoutBtn" class="btn danger small">ฤฤng xuแบฅt</button>
    </div>
  </aside>

  <main class="chat">
    <header class="chat-header">
      <div class="contact">
        <div class="avatar" id="peerAvatar">๐</div>
        <div class="meta">
          <div id="peerName" class="name">Chแปn mแปt cuแปc trรฒ chuyแปn</div>
          <div id="peerStatus" class="status">โ</div>
        </div>
      </div>
      <div class="actions">
        <button class="icon-btn" id="callBtn">๐</button>
        <button class="icon-btn" id="videoBtn">๐ฅ</button>
        <button class="icon-btn" id="searchBtn">๐</button>
        <button class="icon-btn" id="groupSettingsBtn" title="Cรi ฤแบทt nhรณm">โ๏ธ</button>

      </div>
    </header>

<section class="messages" id="messages" aria-live="polite"></section>
<div id="typingIndicator" class="typing-indicator hidden">ฤang nhแบญp...</div>

<!-- Thanh preview แบฃnh -->
<div id="previewBar" class="preview-bar hidden" aria-live="polite"></div>

<!-- โ Emoji picker: web component tแปซ npm -->
<emoji-picker id="emojiPicker" class="emoji-panel hidden"></emoji-picker>

<footer class="composer">
  <button class="icon-btn" id="emojiBtn" aria-label="Emoji">๐</button>
  <input id="messageInput" placeholder="Nhแบญp tin nhแบฏn..." autocomplete="off" />
  <input id="imageInput" type="file" accept="image/*" hidden />
  <button class="icon-btn" id="attachBtn" aria-label="ฤรญnh kรจm">๐</button>
  <button class="btn primary" id="sendBtn">Gแปญi</button>
</footer>

  </main>
  <!-- ==== Modal Tแบกo Nhรณm ==== -->
<div id="groupModal" class="modal hidden">
  <div class="modal-content">
    <h3>Tแบกo nhรณm mแปi</h3>
    <label>Tรชn nhรณm:</label>
    <input type="text" id="groupNameInput" placeholder="Nhแบญp tรชn nhรณm...">

    <div class="user-list" id="userList"></div>

    <div class="actions">
      <button class="btn outline" id="cancelGroupBtn">Hแปงy</button>
      <button class="btn primary" id="confirmGroupBtn">Tแบกo nhรณm</button>
    </div>
  </div>
</div>
<!-- ==== Modal Cรi ฤแบทt Nhรณm ==== -->
<div id="groupSettingsModal" class="modal hidden">
  <div class="modal-content">
    <h3>Cรi ฤแบทt nhรณm</h3>
    <div class="settings-section">
      <button class="btn outline" id="renameGroupBtn">โ๏ธ ฤแปi tรชn nhรณm</button>
      <button class="btn outline" id="addMemberBtn">โ Thรชm thรnh viรชn</button>
      <button class="btn outline" id="removeMemberBtn">โ Xรณa thรnh viรชn</button>
      <button class="btn outline danger" id="leaveGroupBtn">๐ช Rแปi nhรณm</button>
    </div>
    <div class="actions">
      <button class="btn" id="closeGroupSettingsBtn">ฤรณng</button>
    </div>
  </div>
</div>
<div id="friendSearchModal" class="modal hidden">
  <div class="modal-content">
    <h3>Tรฌm kiแบฟm Bแบกn bรจ</h3>
    <div class="search-input-group">
      <input type="text" id="friendSearchInput" placeholder="Nhแบญp tรชn, username hoแบทc email..." />
      <button class="btn primary" id="doFriendSearchBtn">Tรฌm</button>
    </div>
    <div class="user-list" id="friendSearchResultList" style="max-height: 40vh; overflow-y: auto;">
      <div style='padding:10px'>Tรฌm kiแบฟm ฤแป bแบฏt ฤแบงu...</div>
    </div>
    <div class="actions">
      <button class="btn" id="closeFriendSearchBtn">ฤรณng</button>
    </div>
  </div>
</div>
<div id="friendRequestsModal" class="modal hidden">
  <div class="modal-content">
    <h3>Yรชu cแบงu Kแบฟt bแบกn ฤแบฟn</h3>
    <div class="user-list" id="friendRequestList" style="max-height: 50vh; overflow-y: auto;">
      <div style='padding:10px'>ฤang tแบฃi yรชu cแบงu...</div>
    </div>
    <div class="actions">
      <button class="btn" id="closeFriendRequestsBtn">ฤรณng</button>
    </div>
  </div>
</div>
</div>

<%
// yield thรชm scripts riรชng cแปงa trang chat
scripts = `
  <script src="/js/chat.js"></script>
`;
%>
